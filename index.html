<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>智能单词闪卡系统</title>
    <style>
        :root {
            --primary-color: #2196F3;
            --success-color: #4CAF50;
            --error-color: #f44336;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #f5f5f5;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            margin: 0;
            padding: 15px;
            box-sizing: border-box;
            position: relative;
        }

        .stats {
            position: fixed;
            left: 15px;
            top: 15px;
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-size: 16px;
            z-index: 100;
            min-width: 120px;
            text-align: center;
        }

        .flashcard-wrapper {
            width: 100%;
            height: 50vh;
            min-height: 300px;
            margin: 70px 0 30px;
            flex-shrink: 0;
        }

        .flashcard-container {
            perspective: 1000px;
            width: 100%;
            height: 100%;
            position: relative;
        }

        .flashcard {
            width: 100%;
            height: 100%;
            position: absolute;
            transform-style: preserve-3d;
            transition: transform 0.4s;
            touch-action: manipulation;
        }

        .flashcard.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            box-sizing: border-box;
            overflow: auto;
        }

        .front {
            font-size: 2.4rem;
            color: var(--primary-color);
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }

        .back {
            transform: rotateY(180deg);
            padding: 20px;
        }

        .translation {
            font-size: 2rem;
            color: var(--success-color);
            margin: 15px 0;
            text-align: center;
            line-height: 1.3;
        }

        .controls {
            display: flex;
            gap: 12px;
            margin: 20px 0;
            width: 100%;
            position: relative;
            z-index: 50;
        }

        button {
            padding: 16px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1rem;
            flex: 1;
            min-width: 44px;
            min-height: 44px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .master-btn {
            background: var(--success-color);
            color: white;
        }

        .next-btn {
            background: #FF9800;
            color: white;
        }

        .manage-panel {
            position: fixed;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 100;
            width: 90%;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .mastered-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: white;
            padding: 20px;
            overflow-y: auto;
            transform: translateX(100%);
            transition: transform 0.3s;
            z-index: 200;
        }

        .mastered-panel.active {
            transform: translateX(0);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
        }

        .panel-header h3 {
            margin: 0;
            flex: 1;
        }

        .close-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 8px 20px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .close-btn:hover {
            background: #1976D2;
            transform: translateY(-1px);
        }

        .mastered-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            font-size: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }

        .mastered-item:hover {
            background: #f5f5f5;
        }

        .delete-btn {
            color: var(--error-color);
            font-size: 1.2rem;
            padding: 8px;
            margin-left: 10px;
        }

        .privacy-notice {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 500px;
            text-align: center;
            padding: 12px;
            background: rgba(255,255,255,0.95);
            border-radius: 8px;
            font-size: 0.8rem;
            color: #666;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 90;
        }

        /* 新增在原有样式末尾，媒体查询前 */
		.speaker-btn {
		    position: absolute;
		    top: 15px;
		    right: 15px;
		    background: none;
		    border: none;
		    font-size: 1.5rem;
		    cursor: pointer;
		    padding: 5px;
		    z-index: 10;
		}
		.speaker-btn:active {
		    transform: scale(0.9);
		}

        #details {
            font-size: 1rem;
            color: #666;
            text-align: center;
            line-height: 1.4;
            margin-top: 15px;
            padding: 0 10px;
        }

        @media (min-width: 768px) {
            body {
                padding: 20px;
                max-width: 500px;
                margin: 0 auto;
            }
            
            .flashcard-wrapper {
                height: 280px;
                margin: 30px 0;
            }
            
            .front { font-size: 2.5rem; }
            .translation { font-size: 1.8rem; }
            
            .manage-panel {
                width: auto;
                left: auto;
                right: 20px;
                transform: none;
            }
        }

        @media (max-width: 480px) {
            .stats {
                padding: 12px 15px;
                font-size: 14px;
                left: 10px;
                top: 10px;
            }

            .flashcard-wrapper {
                height: 55vh;
                min-height: 250px;
                margin: 60px 0 25px;
            }
            
            .front {
                font-size: 2rem;
                padding: 15px;
            }
            
            .translation {
                font-size: 1.8rem;
            }
            
            .controls {
                flex-direction: row;
                margin: 15px 0;
                gap: 8px;
            }
            
            button {
                width: auto;
                padding: 12px 15px !important;
                font-size: 1rem !important;
            }

		    .next-btn {
		        position: relative;
		        font-size: 0; /* 隐藏原始文字 */
		    }
		    .next-btn::after {
		        content: "下一个";
		        font-size: 1rem !important;
		        position: absolute;
		        left: 50%;
		        top: 50%;
		        transform: translate(-50%, -50%);
		        white-space: nowrap;
		    }
            
            .privacy-notice {
                bottom: 90px;
                font-size: 0.75rem;
                padding: 10px;
            }

            .speaker-btn {
    		    font-size: 1.2rem;
    		    top: 10px;
    		    right: 10px;
    		}
        }
    </style>
    <script>
        const embeddedWordData = {
      "一年级上": {
        "Module1": [
          {
            "word": "hello",
            "translation": "你好",
            "pos": "名词",
            "definition": "Hello! 你好！",
            "example": "Hello! 你好！"
          },
          {
            "word": "am",
            "translation": "是（我是）",
            "pos": "名词",
            "definition": "am",
            "example": "The American team won the championship."
          },
          {
            "word": "goodbye",
            "translation": "再见",
            "pos": "名词",
            "definition": "Goodbye is an action that means to send a message to someone you miss. It also implies leaving behind something or someone.",
            "example": "The teacher gave a goodbye at the end of the exam."
          }
        ]
      }
    };

	    function speakWord() {
	    if (!currentWord) return;
	    const utterance = new SpeechSynthesisUtterance(currentWord.word);
	    utterance.lang = 'en-US';
	    speechSynthesis.speak(utterance);
	    event.stopPropagation(); // 阻止事件冒泡
	}      

    	</script>	    

</head>
<body>
    <div class="stats">
        <span id="progress">进度：0/0</span>
    </div>

    <div class="flashcard-wrapper">
        <div class="flashcard-container">
            <div class="flashcard">
				<div class="card-face front">
				    <button class="speaker-btn" onclick="speakWord()">🔊</button>
				    <span id="current-word">Loading...</span>
				</div>
                <div class="card-face back">
                    <div class="translation" id="translation"></div>
                    <div id="details"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="controls">
        <button class="master-btn" onclick="markAsMastered()">已掌握</button>
        <button class="next-btn" onclick="nextWord()">下一个</button>
    </div>

    <div class="manage-panel">
        <button onclick="showMasteredWords()">管理已掌握单词</button>
        <button onclick="clearAllProgress()" style="margin-top: 10px;">重置学习进度</button>
    </div>

    <div class="mastered-panel" id="masteredPanel">
        <div class="panel-header">
            <h3>已掌握单词（点击删除）</h3>
            <button class="close-btn" onclick="closeMasteredPanel()">返回</button>
        </div>
        <div id="masteredList"></div>
    </div>

    <div class="privacy-notice">
        <small>
          📌 隐私说明：您的学习进度数据（已掌握单词）仅存储在本地设备中，不会上传至任何服务器。
          清除浏览器缓存将删除这些数据，您也可以随时使用本页面的<a href="javascript:clearAllProgress()">重置学习进度</a>功能。
        </small>
    </div>

    <script>
        let allWords = [];
        let currentWord = null;
        let masteredWords = JSON.parse(localStorage.getItem('masteredWords') || '[]');

        // 初始化数据
        function initializeData() {
            try {
                allWords = flattenData(embeddedWordData);
                if(allWords.length === 0) throw new Error("词库为空");
                updateProgress();
                nextWord();
            } catch (error) {
                console.error('初始化失败:', error);
                document.getElementById('current-word').textContent = "数据加载失败";
            }
        }

        function flattenData(data) {
            return Object.entries(data).flatMap(([grade, modules]) => 
                Object.entries(modules).flatMap(([module, words]) => 
                    words.map(word => ({
                        ...word,
                        grade,
                        module
                    }))
                )
            );
        }

        function getRandomWord() {
            const availableWords = allWords.filter(word => 
                !masteredWords.includes(word.word)
            );
            return availableWords[Math.floor(Math.random() * availableWords.length)];
        }

        function updateCard(word) {
            currentWord = word;
            document.getElementById('current-word').textContent = word.word;
            document.getElementById('translation').textContent = word.translation;
            document.getElementById('details').innerHTML = `
                <p>年级：${word.grade}｜单元：${word.module}</p>
                <p style="margin-top:15px;color:#666">${word.example}</p>
            `;
            adjustFontSize();
        }

        function nextWord() {
            const word = getRandomWord();
            if (!word) return alert("所有单词已学习完成！");
            document.querySelector('.flashcard').classList.remove('flipped');
            setTimeout(() => updateCard(word), 300);
        }

        function markAsMastered() {
            if (!currentWord) return;
            const flashcard = document.querySelector('.flashcard');
            const isFront = !flashcard.classList.contains('flipped');

            if (isFront) {
                flashcard.classList.add('flipped');
                setTimeout(() => {
                    if (!masteredWords.includes(currentWord.word)) {
                        masteredWords.push(currentWord.word);
                        localStorage.setItem('masteredWords', JSON.stringify(masteredWords));
                        updateProgress();
                    }
                    nextWord();
                }, 3000);
            } else {
                if (!masteredWords.includes(currentWord.word)) {
                    masteredWords.push(currentWord.word);
                    localStorage.setItem('masteredWords', JSON.stringify(masteredWords));
                    updateProgress();
                }
                nextWord();
            }
        }

        function updateProgress() {
            document.getElementById('progress').textContent = 
                `进度：${masteredWords.length}/${allWords.length}`;
        }

        function showMasteredWords() {
            document.getElementById('masteredPanel').classList.add('active');
            const listContainer = document.getElementById('masteredList');
            listContainer.innerHTML = masteredWords.map(wordStr => {
                const wordData = allWords.find(w => w.word === wordStr);
                return `
                    <div class="mastered-item" onclick="handleMasteredWord('${wordStr}')">
                        <div>${wordStr}</div>
                        <div style="font-size:0.9em;color:#666">${wordData?.translation || '翻译未找到'}</div>
                        <span class="delete-btn" onclick="removeMasteredWord('${wordStr}')">× 删除</span>
                    </div>
                `;
            }).join('');
        }

        function closeMasteredPanel() {
            document.getElementById('masteredPanel').classList.remove('active');
        }

        function removeMasteredWord(word) {
            event.stopPropagation();
            masteredWords = masteredWords.filter(w => w !== word);
            localStorage.setItem('masteredWords', JSON.stringify(masteredWords));
            updateProgress();
            showMasteredWords();
        }

        function handleMasteredWord(word) {
            const items = document.querySelectorAll('.mastered-item');
            items.forEach(item => item.style.background = 'transparent');
            event.currentTarget.style.background = '#f5f5f5';
        }

        function clearAllProgress() {
            if (confirm("确认要重置所有学习进度吗？")) {
                masteredWords = [];
                localStorage.removeItem('masteredWords');
                updateProgress();
                nextWord();
                closeMasteredPanel();
            }
        }

        function adjustFontSize() {
            const elements = [document.getElementById('current-word'), document.getElementById('translation')];
            elements.forEach(el => {
                if (!el) return;
                let fontSize = parseInt(window.getComputedStyle(el).fontSize);
                while (el.scrollHeight > el.offsetHeight && fontSize > 20) {
                    fontSize--;
                    el.style.fontSize = fontSize + 'px';
                }
            });
        }

        // 事件监听
		document.querySelector('.flashcard').addEventListener('click', (e) => {
		    if (
		        e.target.closest('button') || 
		        e.target.closest('.translation') ||
		        e.target.closest('#details') ||
		        e.target.closest('.speaker-btn') // 新增排除喇叭按钮
		    ) return;
		    document.querySelector('.flashcard').classList.toggle('flipped');
		});

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.mastered-panel') && 
                !e.target.closest('.manage-panel button')) {
                closeMasteredPanel();
            }
        });

        // 手势支持
        let touchStartX = 0;
        const flashcard = document.querySelector('.flashcard');
        flashcard.addEventListener('touchstart', e => {
            touchStartX = e.touches[0].clientX;
        });
        flashcard.addEventListener('touchend', e => {
            const touchEndX = e.changedTouches[0].clientX;
            const diffX = touchEndX - touchStartX;
            if (Math.abs(diffX) > 50) {
                flashcard.classList.toggle('flipped');
            }
        });

        window.addEventListener('resize', adjustFontSize);
        window.addEventListener('load', initializeData);
    </script>
</body>
</html>
